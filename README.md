# Dream of a Jaguar 
A simple ancient Mayan themed side-scrolling video game with a twist: All of the characters can be randomly generated by A.I.! Made with pygame, PIL, stable diffusion, and more...

**Final project for Harvard edX CS50P ending Dec. 30, 2022.**

#### Video Demo: <URL_HERE>

## Description:
Try to survive as long as possible by jumping over, crouching under, and/or attacking enemy units. 

### Controls ###
- Jump - ```UP```
- Crouch - ```DOWN```
- Forward - ```RIGHT```
- Backward - ```LEFT```
- Attack - ```SPACE```
- Save & Exit - ```ESCAPE```

## Features ##
- Generate brand new, never before seen enemy A.I. units!
<br>**requires API KEY from [replicate.com](https://replicate.com)

- Pressing ```ESCAPE``` during gameplay will save your game and exit. The next time you run the game your previous game will be restored for you to continue playing. 

- An overall high score is also maintained for your enjoyment.

- There might also be a hidden easter egg... ;)

## Regular Mode ##
Uses only out of the box / baked-in enemy units.
```
pip install pygame
pip install pillow
python project.py
```

## Dream Mode ##
Uses never-before-seen enemy units, dynamically generated via A.I.!
<br>**requires API KEY from [replicate.com](https://replicate.com)
```
pip install pygame
pip install pillow
pip install replicate
export REPLICATE_API_TOKEN=<api_key>
```
...and then, to auto-generate and load 6 new A.I. units:
```
python project.py --dream
```
Or to just use the previously generated set of units:
```
python project.py
```


## Project structure:

The project is oprganized as follows:
- ```project.py``` - the main python file you need to execute to run the game.
- ```game.py``` - 'Game' class responsible for composing all of the various classes, functions, and capabilities into a cohesive game. 
- ```player.py``` - 'Player' class responsible for encapsulating all of the player-related attributes and logic.
- ```enemy.py``` - 'Enemy' class responsible for encapsulating all of the enemy-related attributes and logic.
- ```main_screen.py``` -  'MainScreen' class responsible for encapsulating all of the main screen related attributes and logic.
- ```config.py``` - game constants such as gravity, ground height, screen size, player velocity, etc.
- ```test_project.py``` - tests for verifying everything in ```project.py``` are working as expected.
- ```README.md``` - **You are here**
- ```requirements.txt``` - list of pip libraries required
- ```audio/``` - directory containing all of the sound and music assets
- ```graphics/``` - directory containing all of the graphical assets in a format suitable for the game to use
- ```stable-diffusion/``` - directory containing all of the stable diffusion related files and assets. Explained further in detail below.

## Baked-In Game Assets ##
We utlilized [midjourney](https://www.midjourney.com/home/) & [Dall-E 2](https://openai.com/dall-e-2/) to help generate the visual assets used in the game. For instance, the main player character was generated directly via Dall-E 2 with prompt: ```Ancient Mayan Jaguar Chaac God 16-bit style```. 

Using Gimp, we then manually created all of the character image variations including: stand, walk, crouch, jump, walk-attack, jump-attack, and just for fun, crouch-attack :)

The background layers/assets were purchased from here:<br> https://gameartpartners.com/downloads/mayan-temple-game-background/

Music and sound effects were obtained from various free gaming content websites, such as: freesound.org, pixabay.com, and chosic.com.

[See asset attributions below](#ca).

## AI Generated Assets

A.I. generated enemy units need 4 frames so that they can be animated when moving across the screen. Here is an example of how the 4 frames are formatted in a single image: 

![four frame sprite example](stable_diffusion/init_image/bird2.png)

In order to generate a random creature and also have the A.I. include four frames (like in the example above), we're leveraging stable diffusion's ```init_image``` feature, which allows you to specify an input image for the A.I. to use to derive a new image from. We manually doctored several ```init_images```, for both air and ground units, which are then randomly selected from when generating new units. We then provide the ```init_image``` , along with a carefully curated prompt, weights, and other settings to making a request to replicate.com via their python library.

When all of the parameters are adjusted just right, it can produce some amazing results! However, it's also very unpredictable and can generate undesirable results. While we strive to refine this technique, we realize it's not fool proof and so we need a way to overcome bad results. Letting the player directly participate and choose their favorite units seemed like a great way to engage the user and expose them to the concept of A.I. generated content, which is part of the fun of the game!


## Game Concept and Development Process ##
We brainstormed for days before finally settling on a game. At first all we knew was that we wanted it to be ancient Mayan themed and utilize machine learning / A.I. in some novel and fun way.

YouTube has a ton of great pygame tutorials and after watching a bunch we decided to create a super simple side-scrolling "flappy-bird" style game to keep the scope limited.

Around the same time we were also heavily experimenting with Dall-E 2, Mid Journey, and Stable Diffusion for producing A.I. generated art from simple text prompts. We decided we wanted to use these A.I. models to help us create some of our game art. Specifically:

- The panning background on the main screen was generated by Mid Journey.
- The main player character was generated by Dall-E 2 and then hand-edited in Gimp to create all of the needed frames for the animtations.

After managing to get stable-diffusion to run locally, we realized we could totally embed stable-diffusion in our game (they're both python) and have our game use it to dynamically generate content, "on the fly"!!!

This proved to be impractical and cumbersome however, not to mention the model files are massive (5-7GB depending on version). Then we discovered [replicate.com](https://replicate.com), which offers a web API for running Stable-Diffusion models in the cloud, as-a-service. This approach seemed to offer better experience.

To enable this feature, sign up for a replicate.com account and get an API KEY. Add this API KEY to your ENV and then run:

```
python project.py --dream
```
The game will automatically "dream" up 6 new unique enemy units, 3 flying units, 3 ground units, never before seen by anyone.  This will take a minute depending on internet speed. Once complete, the enemy units will be displayed on the main screen. The player can then click on a unit to replace that one with a newly generated unit. Since the A.I. sometimes generates weird / undesirable results, this engages the player to explore and participate in dynamic A.I. content curation.

Once you like all of the units that are currently displayed, simply press ```SPACE``` to start a game with the units you just created!

If you want to keep the 6 units you currently have just be sure to run the game again without the ```--dream``` switch:
```
python project.py
```

This will start the game and utilize the last 6 A.I. genereted units.



## Background Animation ##
The intro screen background was generated via Midjourney.

We discussed several ideas for the game background while playing, including additional A.I. generated art, but after finding the background assets linked to above, we decided we decided to go with a parallax scrolling background because the assets looked great, fit our needs, and because we've always wanted to learn how to do parallax scrolling. This was very satisfying to implement and to see working!

## Gameplay ##
The game started out as a simple "flappy-bird"-style game where you just jump over enemies. However, we added additional gameplay functionality to make the game more fun. This included the ability to move forwards & backwards, crouching, and attacking. We also added attack effects, sounds, high score, game persitence, and various other little tweaks :)



## Installation ##

## Asset Attibution...
<a name="ca"></a>
- [Background Track](audio/legend-of-narmer.mp3):  
The Legend of Narmer by WombatNoisesAudio | https://soundcloud.com/user-734462061
Creative Commons Attribution 3.0 Unported License
https://creativecommons.org/licenses/by/3.0/
Music promoted by https://www.chosic.com/free-music/all/
